syntax = "proto3";

package city.economy.v2;

import "city/economy/v2/economy.proto";

// OrgService 提供了经济系统中组织和代理的管理接口
// 包括基本的CRUD操作、批量操作、增量更新和各种计算功能
service OrgService {
  // Firm 相关操作
  rpc AddFirm(AddFirmRequest) returns (AddFirmResponse);
  rpc RemoveFirm(RemoveFirmRequest) returns (RemoveFirmResponse);
  rpc GetFirm(GetFirmRequest) returns (GetFirmResponse);
  rpc UpdateFirm(UpdateFirmRequest) returns (UpdateFirmResponse);
  rpc ListFirms(ListFirmsRequest) returns (ListFirmsResponse);
  rpc DeltaUpdateFirm(DeltaUpdateFirmRequest) returns (DeltaUpdateFirmResponse);
  rpc BatchAddFirm(BatchAddFirmRequest) returns (BatchAddFirmResponse);
  rpc BatchRemoveFirm(BatchRemoveFirmRequest) returns (BatchRemoveFirmResponse);
  rpc BatchGetFirm(BatchGetFirmRequest) returns (BatchGetFirmResponse);
  rpc BatchUpdateFirm(BatchUpdateFirmRequest) returns (BatchUpdateFirmResponse);
  rpc BatchDeltaUpdateFirm(BatchDeltaUpdateFirmRequest) returns (BatchDeltaUpdateFirmResponse);

  // NBS 相关操作
  rpc AddNBS(AddNBSRequest) returns (AddNBSResponse);
  rpc RemoveNBS(RemoveNBSRequest) returns (RemoveNBSResponse);
  rpc GetNBS(GetNBSRequest) returns (GetNBSResponse);
  rpc UpdateNBS(UpdateNBSRequest) returns (UpdateNBSResponse);
  rpc ListNBS(ListNBSRequest) returns (ListNBSResponse);
  rpc DeltaUpdateNBS(DeltaUpdateNBSRequest) returns (DeltaUpdateNBSResponse);

  // Government 相关操作
  rpc AddGovernment(AddGovernmentRequest) returns (AddGovernmentResponse);
  rpc RemoveGovernment(RemoveGovernmentRequest) returns (RemoveGovernmentResponse);
  rpc GetGovernment(GetGovernmentRequest) returns (GetGovernmentResponse);
  rpc UpdateGovernment(UpdateGovernmentRequest) returns (UpdateGovernmentResponse);
  rpc ListGovernments(ListGovernmentsRequest) returns (ListGovernmentsResponse);
  rpc DeltaUpdateGovernment(DeltaUpdateGovernmentRequest) returns (DeltaUpdateGovernmentResponse);

  // Bank 相关操作
  rpc AddBank(AddBankRequest) returns (AddBankResponse);
  rpc RemoveBank(RemoveBankRequest) returns (RemoveBankResponse);
  rpc GetBank(GetBankRequest) returns (GetBankResponse);
  rpc UpdateBank(UpdateBankRequest) returns (UpdateBankResponse);
  rpc ListBanks(ListBanksRequest) returns (ListBanksResponse);
  rpc DeltaUpdateBank(DeltaUpdateBankRequest) returns (DeltaUpdateBankResponse);

  // Agent 相关操作
  rpc AddAgent(AddAgentRequest) returns (AddAgentResponse);
  rpc RemoveAgent(RemoveAgentRequest) returns (RemoveAgentResponse);
  rpc GetAgent(GetAgentRequest) returns (GetAgentResponse);
  rpc UpdateAgent(UpdateAgentRequest) returns (UpdateAgentResponse);
  rpc ListAgents(ListAgentsRequest) returns (ListAgentsResponse);
  rpc DeltaUpdateAgent(DeltaUpdateAgentRequest) returns (DeltaUpdateAgentResponse);
  rpc BatchAddAgent(BatchAddAgentRequest) returns (BatchAddAgentResponse);
  rpc BatchRemoveAgent(BatchRemoveAgentRequest) returns (BatchRemoveAgentResponse);
  rpc BatchGetAgent(BatchGetAgentRequest) returns (BatchGetAgentResponse);
  rpc BatchUpdateAgent(BatchUpdateAgentRequest) returns (BatchUpdateAgentResponse);
  rpc BatchDeltaUpdateAgent(BatchDeltaUpdateAgentRequest) returns (BatchDeltaUpdateAgentResponse);

  // 计算相关操作
  rpc CalculateTaxesDue(CalculateTaxesDueRequest) returns (CalculateTaxesDueResponse);
  rpc CalculateConsumption(CalculateConsumptionRequest) returns (CalculateConsumptionResponse);
  rpc CalculateInterest(CalculateInterestRequest) returns (CalculateInterestResponse);
  rpc CalculateRealGDP(CalculateRealGDPRequest) returns (CalculateRealGDPResponse);

  // 系统状态操作
  rpc SaveEconomyEntities(SaveEconomyEntitiesRequest) returns (SaveEconomyEntitiesResponse);
  rpc LoadEconomyEntities(LoadEconomyEntitiesRequest) returns (LoadEconomyEntitiesResponse);
}

// Firm 相关消息
message AddFirmRequest {
  Firm firm = 1;
}

message AddFirmResponse {}

message RemoveFirmRequest {
  int32 firm_id = 1;
}

message RemoveFirmResponse {}

message GetFirmRequest {
  int32 firm_id = 1;
}

message GetFirmResponse {
  Firm firm = 1;
}

message UpdateFirmRequest {
  Firm firm = 1;
}

message UpdateFirmResponse {}

message ListFirmsRequest {}

message ListFirmsResponse {
  repeated Firm firms = 1;
}

message DeltaUpdateFirmRequest {
  int32 firm_id = 1;
  optional float delta_price = 2;
  optional int32 delta_inventory = 3;
  optional float delta_demand = 4;
  optional float delta_sales = 5;
  optional float delta_currency = 6;
  repeated int32 add_employees = 7;
  repeated int32 remove_employees = 8;
}

message DeltaUpdateFirmResponse {}

// Firm 批处理相关消息
message BatchAddFirmRequest {
  repeated Firm firms = 1;
}

message BatchAddFirmResponse {
  repeated int32 firm_ids = 1;
}

message BatchRemoveFirmRequest {
  repeated int32 firm_ids = 1;
}

message BatchRemoveFirmResponse {}

message BatchGetFirmRequest {
  repeated int32 firm_ids = 1;
}

message BatchGetFirmResponse {
  repeated Firm firms = 1;
}

message BatchUpdateFirmRequest {
  repeated Firm firms = 1;
}

message BatchUpdateFirmResponse {}

message BatchDeltaUpdateFirmRequest {
  repeated DeltaUpdateFirmRequest updates = 1;
}

message BatchDeltaUpdateFirmResponse {}

// NBS 相关消息
message AddNBSRequest {
  NBS nbs = 1;
}

message AddNBSResponse {}

message RemoveNBSRequest {
  int32 nbs_id = 1;
}

message RemoveNBSResponse {}

message GetNBSRequest {
  int32 nbs_id = 1;
}

message GetNBSResponse {
  NBS nbs = 1;
}

message UpdateNBSRequest {
  NBS nbs = 1;
}

message UpdateNBSResponse {}

message ListNBSRequest {}

message ListNBSResponse {
  repeated NBS nbs_list = 1;
}

message DeltaUpdateNBSRequest {
  int32 nbs_id = 1;
  map<string, float> delta_nominal_gdp = 2;
  map<string, float> delta_real_gdp = 3;
  map<string, float> delta_unemployment = 4;
  map<string, float> delta_wages = 5;
  map<string, float> delta_prices = 6;
  map<string, float> delta_working_hours = 7;
  map<string, float> delta_depression = 8;
  map<string, float> delta_consumption_currency = 9;
  map<string, float> delta_income_currency = 10;
  map<string, float> delta_locus_control = 11;
  optional float delta_currency = 12;
  repeated int32 add_citizens = 13;
  repeated int32 remove_citizens = 14;
  repeated int32 add_citizens_agent_id = 15;
  repeated int32 remove_citizens_agent_id = 16;
}

message DeltaUpdateNBSResponse {}

// Government 相关消息
message AddGovernmentRequest {
  Government government = 1;
}

message AddGovernmentResponse {}

message RemoveGovernmentRequest {
  int32 government_id = 1;
}

message RemoveGovernmentResponse {}

message GetGovernmentRequest {
  int32 government_id = 1;
}

message GetGovernmentResponse {
  Government government = 1;
}

message UpdateGovernmentRequest {
  Government government = 1;
}

message UpdateGovernmentResponse {}

message ListGovernmentsRequest {}

message ListGovernmentsResponse {
  repeated Government governments = 1;
}

message DeltaUpdateGovernmentRequest {
  int32 government_id = 1;
  repeated float delta_bracket_cutoffs = 2;
  repeated float delta_bracket_rates = 3;
  optional float delta_currency = 4;
  repeated int32 add_citizens = 5;
  repeated int32 remove_citizens = 6;
}

message DeltaUpdateGovernmentResponse {}

// Bank 相关消息
message AddBankRequest {
  Bank bank = 1;
}

message AddBankResponse {}

message RemoveBankRequest {
  int32 bank_id = 1;
}

message RemoveBankResponse {}

message GetBankRequest {
  int32 bank_id = 1;
}

message GetBankResponse {
  Bank bank = 1;
}

message UpdateBankRequest {
  Bank bank = 1;
}

message UpdateBankResponse {}

message ListBanksRequest {}

message ListBanksResponse {
  repeated Bank banks = 1;
}

message DeltaUpdateBankRequest {
  int32 bank_id = 1;
  optional float delta_interest_rate = 2;
  optional float delta_currency = 3;
  repeated int32 add_citizens = 4;
  repeated int32 remove_citizens = 5;
}

message DeltaUpdateBankResponse {}

// Agent 相关消息
message AddAgentRequest {
  Agent agent = 1;
}

message AddAgentResponse {}

message RemoveAgentRequest {
  int32 agent_id = 1;
}

message RemoveAgentResponse {}

message GetAgentRequest {
  int32 agent_id = 1;
}

message GetAgentResponse {
  Agent agent = 1;
}

message UpdateAgentRequest {
  Agent agent = 1;
}

message UpdateAgentResponse {}

message ListAgentsRequest {}

message ListAgentsResponse {
  repeated Agent agents = 1;
}

message DeltaUpdateAgentRequest {
  int32 agent_id = 1;
  optional float delta_currency = 2;
  optional int32 new_firm_id = 3;
  optional float delta_skill = 4;
  optional float delta_consumption = 5;
  optional float delta_income = 6;
}

message DeltaUpdateAgentResponse {}

// Agent 批处理相关消息
message BatchAddAgentRequest {
  repeated Agent agents = 1;
}

message BatchAddAgentResponse {
  repeated int32 agent_ids = 1;
}

message BatchRemoveAgentRequest {
  repeated int32 agent_ids = 1;
}

message BatchRemoveAgentResponse {}

message BatchGetAgentRequest {
  repeated int32 agent_ids = 1;
}

message BatchGetAgentResponse {
  repeated Agent agents = 1;
}

message BatchUpdateAgentRequest {
  repeated Agent agents = 1;
}

message BatchUpdateAgentResponse {}

message BatchDeltaUpdateAgentRequest {
  repeated DeltaUpdateAgentRequest updates = 1;
}

message BatchDeltaUpdateAgentResponse {}

// 计算相关消息
message CalculateTaxesDueRequest {
  int32 government_id = 1;
  repeated int32 agent_ids = 2;
  repeated float incomes = 3;
  bool enable_redistribution = 4;
}

message CalculateTaxesDueResponse {
  float taxes_due = 1;
  repeated float updated_incomes = 2;
}

message CalculateConsumptionRequest {
  repeated int32 firm_ids = 1;
  int32 agent_id = 2;
  repeated int32 demands = 3;
  optional bool consumption_accumulation = 4;
}

message CalculateConsumptionResponse {
  float actual_consumption = 1;
  bool success = 2;
}

message CalculateInterestRequest {
  int32 bank_id = 1;
  repeated int32 agent_ids = 2;
}

message CalculateInterestResponse {
  float total_interest = 1;
  repeated float updated_currencies = 2;
}

message CalculateRealGDPRequest {
  int32 nbs_id = 1;
}

message CalculateRealGDPResponse {
  float real_gdp = 1;
}

// 系统状态相关消息
message SaveEconomyEntitiesRequest {
  string file_path = 1;
}

message SaveEconomyEntitiesResponse {
  repeated int32 firm_ids = 1;
  repeated int32 nbs_ids = 2;
  repeated int32 government_ids = 3;
  repeated int32 bank_ids = 4;
  repeated int32 agent_ids = 5;
}

message LoadEconomyEntitiesRequest {
  string file_path = 1;
}

message LoadEconomyEntitiesResponse {
  repeated int32 firm_ids = 1;
  repeated int32 nbs_ids = 2;
  repeated int32 government_ids = 3;
  repeated int32 bank_ids = 4;
  repeated int32 agent_ids = 5;
}
